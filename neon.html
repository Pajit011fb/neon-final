<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neon Sign Customizer</title>
    <style>
        :root {
            --primary-color: #6200EA; /* Purple */
            --accent-color: #03DAC6; /* Teal */
            --background-color: #121212; /* Dark Background */
            --text-color: #FFFFFF; /* White Text */
            --controller-bg: rgba(30, 30, 30, 0.9); /* Semi-transparent dark */
        }

        body {
            font-family: "Roboto", sans-serif;
            background-color: var(--background-color); /* Dark background */
            color: var(--text-color);
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
        }

        .container {
            display: flex;
            flex-direction: column;
            height: 100%;
            position: relative;
        }

        .controls {
            padding: 1rem;
            background-color: var(--controller-bg);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            margin: 10px;
            flex: 1;
            overflow-y: auto; /* Scrollable */
            position: absolute;
            bottom: 0; /* Positioning at the bottom */
            width: calc(100% - 20px);
            max-height: 40%; /* Fixed above 60% of screen */
            z-index: 10; /* Ensure it sits above other elements */
        }

        h1 {
            color: var(--primary-color);
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        input[type="text"], input[type="range"] {
            width: 100%;
            padding: 0.5rem;
            margin-bottom: 1rem;
            border: 1px solid #CCC;
            border-radius: 4px;
            outline-color: var(--primary-color);
            background-color: rgba(255, 255, 255, 0.1); /* Light background for input */
            color: var(--text-color);
        }

        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            height: 8px;
            background: var(--accent-color);
            border-radius: 5px;
            outline: none;
        }

        .color-picker {
            display: flex;
            margin-bottom: 1rem;
        }

        .color-option {
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            margin-right: 0.5rem;
        }

        .color-option.selected {
            border-color: var(--primary-color);
        }

        .preview {
            flex-grow: 1;
            position: relative;
            overflow: hidden;
            margin: 10px;
            height: 60%; /* Occupy the top 60% */
        }

        canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        @media (min-width: 768px) {
            .container {
                flex-direction: row;
            }

            .controls {
                width: 300px;
                position: static; /* Reset for PC */
                max-height: none; /* Reset max-height for PC */
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="preview">
            <video id="video" autoplay playsinline muted style="display: none;"></video>
            <canvas id="mainCanvas"></canvas>
            <canvas id="neonCanvas" style="display: none;"></canvas>
        </div>
        <div class="controls">
            <h1>Customize Your Neon Sign</h1>
            <label for="text">Text</label>
            <input type="text" id="text" value="Your Text Here">
            <label>Color</label>
            <div class="color-picker" id="colorPicker"></div>
            <label for="size">Size</label>
            <input type="range" id="size" min="20" max="100" value="50">
            <label for="angle">Angle</label>
            <input type="range" id="angle" min="-180" max="180" value="0">
            <label for="intensity">Glow Intensity</label>
            <input type="range" id="intensity" min="0" max="1" step="0.01" value="0.5">
            <label for="spread">Glow Spread</label>
            <input type="range" id="spread" min="0" max="50" value="20">
            <label for="darkness">Room Darkness</label>
            <input type="range" id="darkness" min="0" max="1" step="0.01" value="0.5">
            <label for="neonDarkness">Neon Darkness</label>
            <input type="range" id="neonDarkness" min="0" max="1" step="0.01" value="0.8">
        </div>
    </div>

    <script>
        // Your existing JavaScript code remains unchanged
        const neonColors = ['#ffffff', '#ff00ff', '#00ff00', '#0000ff', '#800080'];
        const font = "'Orbitron', sans-serif";
        let text = 'Your Text Here';
        let color = neonColors[0];
        let size = 50;
        let angle = 0;
        let intensity = 0.5;
        let spread = 20;
        let darkness = 0.5;
        let neonDarkness = 0.8;
        let position = { x: 320, y: 240 };

        const video = document.getElementById('video');
        const mainCanvas = document.getElementById('mainCanvas');
        const neonCanvas = document.getElementById('neonCanvas');
        const mainCtx = mainCanvas.getContext('2d');
        const neonCtx = neonCanvas.getContext('2d');

        function initColorPicker() {
            const colorPicker = document.getElementById('colorPicker');
            neonColors.forEach((neonColor, index) => {
                const colorOption = document.createElement('div');
                colorOption.className = 'color-option' + (index === 0 ? ' selected' : '');
                colorOption.style.backgroundColor = neonColor;
                colorOption.addEventListener('click', () => {
                    document.querySelectorAll('.color-option').forEach(opt => opt.classList.remove('selected'));
                    colorOption.classList.add('selected');
                    color = neonColor;
                    drawNeonText();
                });
                colorPicker.appendChild(colorOption);
            });
        }

        function startCamera() {
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(stream => {
                    video.srcObject = stream;
                    video.play();
                })
                .catch(err => {
                    console.error("Error accessing the camera:", err);
                    alert("Unable to access the camera. Please make sure you've granted the necessary permissions.");
                });
        }

        function drawNeonText() {
            neonCanvas.width = 1000;
            neonCanvas.height = 1000;
            neonCtx.clearRect(0, 0, neonCanvas.width, neonCanvas.height);
            neonCtx.font = `${size * 2}px ${font}`;
            neonCtx.textAlign = 'center';
            neonCtx.textBaseline = 'middle';

            const adjustedIntensity = intensity * (1 + darkness);
            const adjustedSpread = spread * (1 + darkness);

            for (let i = adjustedSpread; i > 0; i -= 1) {
                neonCtx.shadowBlur = i;
                neonCtx.shadowColor = color;
                neonCtx.fillStyle = `rgba(${parseInt(color.slice(1, 3), 16)}, ${parseInt(color.slice(3, 5), 16)}, ${parseInt(color.slice(5, 7), 16)}, ${adjustedIntensity * (1 - i / adjustedSpread)})`;
                neonCtx.fillText(text, neonCanvas.width / 2, neonCanvas.height / 2);
            }

            neonCtx.shadowBlur = 0;
            neonCtx.fillStyle = 'white';
            neonCtx.fillText(text, neonCanvas.width / 2, neonCanvas.height / 2);
        }

        function updateCanvas() {
            mainCanvas.width = mainCanvas.offsetWidth;
            mainCanvas.height = mainCanvas.offsetHeight;
            mainCtx.clearRect(0, 0, mainCanvas.width, mainCanvas.height);
            
            mainCtx.drawImage(video, 0, 0, mainCanvas.width, mainCanvas.height);
            mainCtx.fillStyle = `rgba(0, 0, 0, ${darkness * 1.5})`;
            mainCtx.fillRect(0, 0, mainCanvas.width, mainCanvas.height);
            
            mainCtx.globalCompositeOperation = 'overlay';
            mainCtx.fillStyle = `rgba(${parseInt(color.slice(1, 3), 16)}, ${parseInt(color.slice(3, 5), 16)}, ${parseInt(color.slice(5, 7), 16)}, ${0.2 + darkness * 0.3})`;
            mainCtx.fillRect(0, 0, mainCanvas.width, mainCanvas.height);
            mainCtx.globalCompositeOperation = 'source-over';
            
            const gradient = mainCtx.createRadialGradient(
                position.x, position.y, 0,
                position.x, position.y, Math.max(mainCanvas.width, mainCanvas.height) * 0.7
            );
            gradient.addColorStop(0, `rgba(255, 255, 255, ${0.7 * (1 - darkness)})`);
            gradient.addColorStop(0.2, `rgba(0, 0, 0, ${neonDarkness * 0.5})`);
            gradient.addColorStop(1, `rgba(0, 0, 0, ${neonDarkness})`);
            
            mainCtx.globalCompositeOperation = 'multiply';
            mainCtx.fillStyle = gradient;
            mainCtx.fillRect(0, 0, mainCanvas.width, mainCanvas.height);
            
            const horizontalGradient = mainCtx.createLinearGradient(0, 0, mainCanvas.width, 0);
            horizontalGradient.addColorStop(0, `rgba(0, 0, 0, ${neonDarkness})`);
            horizontalGradient.addColorStop(0.2, `rgba(0, 0, 0, 0)`);
            horizontalGradient.addColorStop(0.8, `rgba(0, 0, 0, 0)`);
            horizontalGradient.addColorStop(1, `rgba(0, 0, 0, ${neonDarkness})`);
            
            mainCtx.fillStyle = horizontalGradient;
            mainCtx.fillRect(0, 0, mainCanvas.width, mainCanvas.height);
            
            const verticalGradient = mainCtx.createLinearGradient(0, 0, 0, mainCanvas.height);
            verticalGradient.addColorStop(0, `rgba(0, 0, 0, ${neonDarkness * 0.5})`);
            verticalGradient.addColorStop(0.3, `rgba(0, 0, 0, 0)`);
            verticalGradient.addColorStop(0.7, `rgba(0, 0, 0, 0)`);
            verticalGradient.addColorStop(1, `rgba(0, 0, 0, ${neonDarkness * 0.5})`);
            
            mainCtx.fillStyle = verticalGradient;
            mainCtx.fillRect(0, 0, mainCanvas.width, mainCanvas.height);
            
            mainCtx.globalCompositeOperation = 'source-over';
            
            mainCtx.save();
            mainCtx.translate(position.x, position.y);
            mainCtx.rotate(angle * Math.PI / 180);
            mainCtx.drawImage(
                neonCanvas, 
                -neonCanvas.width / 4, 
                -neonCanvas.height / 4, 
                neonCanvas.width / 2, 
                neonCanvas.height / 2
            );
            mainCtx.restore();
            
            mainCtx.globalCompositeOperation = 'overlay';
            mainCtx.fillStyle = `rgba(${parseInt(color.slice(1, 3), 16)}, ${parseInt(color.slice(3, 5), 16)}, ${parseInt(color.slice(5, 7), 16)}, ${0.3})`;
            mainCtx.fillRect(0, 0, mainCanvas.width, mainCanvas.height);
            mainCtx.globalCompositeOperation = 'source-over';

            requestAnimationFrame(updateCanvas);
        }

        function handleMouseMove(e) {
            if (e.buttons === 1) {
                const rect = mainCanvas.getBoundingClientRect();
                position = {
                    x: e.clientX - rect.left,
                    y: e.clientY - rect.top
                };
            }
        }

        document.getElementById('text').addEventListener('input', (e) => {
            text = e.target.value;
            drawNeonText();
        });

        document.getElementById('size').addEventListener('input', (e) => {
            size = parseInt(e.target.value);
            drawNeonText();
        });

        document.getElementById('angle').addEventListener('input', (e) => {
            angle = parseInt(e.target.value);
        });

        document.getElementById('intensity').addEventListener('input', (e) => {
            intensity = parseFloat(e.target.value);
            drawNeonText();
        });

        document.getElementById('spread').addEventListener('input', (e) => {
            spread = parseInt(e.target.value);
            drawNeonText();
        });

        document.getElementById('darkness').addEventListener('input', (e) => {
            darkness = parseFloat(e.target.value);
        });

        document.getElementById('neonDarkness').addEventListener('input', (e) => {
            neonDarkness = parseFloat(e.target.value);
        });

        mainCanvas.addEventListener('mousemove', handleMouseMove);
        mainCanvas.addEventListener('mousedown', handleMouseMove);

        window.addEventListener('load', () => {
            initColorPicker();
            startCamera();
            drawNeonText();
            updateCanvas();
        });

        window.addEventListener('resize', () => {
            mainCanvas.width = mainCanvas.offsetWidth;
            mainCanvas.height = mainCanvas.offsetHeight;
            position = { x: mainCanvas.width / 2, y: mainCanvas.height / 2 };
        });
    </script>
</body>
</html>
